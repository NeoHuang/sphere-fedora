@(data: CommonData, cart: ShopCart)

@main("Cart"){
@helpers.navigationTop(data)
@helpers.navigationMenu(data)
}{
<section> 
    <!--CART STARTS-->
    <div id="shopping_cart" class="full_page">
        <h1>Shopping Cart</h1>
        @if(flash.containsKey("cart-success")) {<div class="message success">@flash.get("cart-success")</div>}
        <div class="action_buttonbar">
            <form action="@getReturnUrl" method="get"><button type="submit" class="continue">Continue Shopping</button></form>
            <form action="@routes.CheckoutController.show" method="get"><button type="submit" class="checkout">Checkout</button></form>
        </div>
        <div class="cart_table">
            <table class="data-table cart-table" id="shopping-cart-table" cellpadding="0" cellspacing="0">
                <tr>
                    <th colspan="2">Products</th>
                    <th class="align_center" width="6%"></th>
                    <th class="align_center" width="12%">Unit Price</th>
                    <th class="align_center" width="10%">Qty</th>
                    <th class="align_center" width="12%">Subtotal</th>
                    <th class="align_center" width="6%"></th>
                </tr>
                @for(item <- cart.getLineItems) {
                             <tr>
                <td width="10%">
                    <a href="@routes.ProductController.selectById(item.getProductId, item.getVariant.getId)">
                        <img src="@item.getVariant.getFeaturedImage.getSize(ImageSize.SMALL).getUrl"></a>
                </td>
                <td class="align_left" width="44%">
                    <a class="pr_name" href="@routes.ProductController.selectById(item.getProductId, item.getVariant.getId)">@item.getProductName</a>
                    @for(selectedAttributeName <- data.selectableAttributeNames){
                                                  @defining(item.getVariant.getAttribute(selectedAttributeName)){ attribute =>
                    @** TODO IMPROVE THIS! **@
                    @if(attribute != null){
                    <span class="pr_info">@selectedAttributeName: @ShopAttribute.of(attribute).getStringValue(data.context.locale)</span><br/>
                    }
                    }
                    }
                    </td>
                <td class="align_center"></td>
                <td class="align_center vline"><span class="price">@printMoney(data.context, item.getPrice.getValue)</span></td>
                <td class="align_center vline">
                    <form action="@routes.CartController.update" method="post">
                        <input type="hidden" name="lineItemId" value="@item.getId"/>
                        <input class="qty_box" name="quantity" type="text" value="@item.getQuantity">
                        <button type="submit">change</button>
                    </form>
                </td>
                <td class="align_center vline"><span class="price">@printMoney(data.context, item.getTotalPrice)</span></td>
                <td class="align_center vline"><a href="@routes.CartController.remove(item.getId)" class="remove"></a></td>
                </tr>
            }
            <tr>
                <td colspan="7">
                    <div id="elefunds">
    </div>
                </td>
            </tr>
            </table>
        
        <div class="totals">
            <table id="totals-table">
                <tr>
                    <td width="60%" colspan="1" class="align_left" ><strong>Subtotal</strong></td>
                    <td class="align_right" style=""><strong><span class="price">@printMoney(data.context, cart.getTotalPrice)</span></strong></td>
                </tr>
                @if(cart.getTaxedPrice.isPresent){
                <tr>
                    @for(taxPortion <- cart.getTaxedPrice.get.getTaxPortions) {
                                       <td width="60%" colspan="1" class="align_left">Tax @percentage(taxPortion.getRate)%</td>
            <td class="align_right" style=""><span class="">@taxPortion.getAmount</span></td>
            }
            </tr>
        }
        @if(cart.getShippingInfo.isPresent){
        <tr>
            <td width="60%" colspan="1" class="align_left" >Shipping cost</td>
            <td class="align_right" style=""><span class="price">@printMoney(data.context, cart.getShippingInfo.get.getPrice)</span></td>
        </tr>
        }
        <tr>
            <td width="60%" colspan="1" class="align_left total"  >Grand Total</td>
            <td class="align_right" style=""><span id="grand-total" class="total" data="@cart.getTotalPrice.getAmount.doubleValue">@printMoney(data.context, cart.getTotalPrice)</span></td>
        </tr>                
        </table>
    </div>
</div>

<div class="action_buttonbar">
    <form action="@getReturnUrl" method="get"><button type="submit" class="continue">Continue Shopping</button></form>
    <form action="@routes.CheckoutController.show" method="get"><button type="submit" class="checkout">Checkout</button></form>
</div>
</div>
<!--CART ENDS--> 

<!--div class="checkout_tax">
<div class="shipping_tax">
<h4>Estimate Shipping and Tax</h4>
<p>Enter your destination to get a shipping estimate.</p>
<label>Country</label><select><option>Canada</option></select><label>Postal code</label><input type="text">
<br class="clear"/>
<label>State</label><select><option>Vancouver</option></select>
<button type="button" title="" class="brown_btn">Get a Quote</button>
</div>
<div class="checkout_discount">
<h4>Discount codes</h4>
<p>Enter your coupon code if you have one.</p>
<input type="text">
<button type="button" title="" class="brown_btn">Apply Coupon</button>
</div>
</div-->

@helpers.newsletter()

</section>
<link rel="stylesheet" href="https://43ce0697b91280cbef31-14c96824618f1f6e4d87350d0f98c98a.ssl.cf1.rackcdn.com/static/elefunds.css">
<script src="https://43ce0697b91280cbef31-14c96824618f1f6e4d87350d0f98c98a.ssl.cf1.rackcdn.com/static/elefunds.min.js" ></script>
<script> 
    var total = $("#grand-total").attr('data') * 100;
    console.log(total);
    window.elefundsOptions = {

    //The view to render.
    //Values: 'module', 'socialMediaShare'
    //Default: 'module'
    view: "module",

    //Design options for the module view.
    skin: {

        //Values: 'dark', 'light'
        //Default: 'light'
        theme: 'light',

        //The color to use for highlighted elements, such as the call-to-action button and + button.
        //Values: all hexadecimal color-values
        //Default: '#00efa2'
        color: '#00efa2',

        //Layout of the module. Flexible will adapt to the width of your container.
        //Values: 'small', 'medium', 'large', 'flexible'
        //Default: 'flexible'
        dimensions: 'flexible',

        //Orientation of the receiver logos.
        //Values: horizontal, vertical
        //Default: horizontal
        orientation: 'horizontal'
    },

    //Show the option for donors to receive a donation receipt.
    //Values: bool
    //Default: false
    offerDonationReceipt: true,

    //Currency symbol to use.
    //Values: any currency symbol
    //Default: '€'
    currency: '€',

    //Values: any delimiter symbol
    //Default: ','
    currencyDelimiter: ',',

    //The order total to round up (in cent)
    // *Required*
    sumExcludingDonation: total,

    //A selector for the form to be submitted needs to be provided. Values required by the module will be copied here.
    //Values: any DOM selector (class, element, id)
    // *Required*
    formSelector: '#donation-form',

    //ClientId
    // *Required*
    clientId: 1001,

    //ForeignId, or unique identifier for the transaction
    // *Required*
    foreignId: 'QWE123',

    //If a grand total is shown, a DOM selector needs to be provided to update the total when the module is activated
    //Values: any DOM selector (class, element, id)
    totalSelector: '#grand-total',

    //Country code for the user
    //Values: 'de', 'en'
    //Default: 'en'
    countryCode: 'en',

    //The element you choose here will be cloned and appended after itself with the donation label as its content (elefunds donation)
    //Helpful when it's desired to show the donation separated from the module (ie. in an order overview)
    //Values: any DOM selector (class, element, id)
    rowLabel: '#lfnds-row-label',

    //The element you choose here will be cloned and appended after itself with the donation value aus content (12.00 €)
    //Helpful when it's desired to show the donation separated from the module (ie. in an order overview)
    //Values: any DOM selector (class, element, id)
    rowValue: '#lfnds-row-value'
}</script>
}{

}